<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Confesiones LLA</title>
  <link rel="stylesheet" href="../CSS/confesiones.css"/>
</head>
<body>
  <header class="topbar">
    <div class="logo">Confesiones <span>LLA</span></div>
    <nav class="nav-buttons">
      <button class="nav-btn" onclick="location.href='https://cdhub.store/'">Inicio</button>
      <button class="nav-btn" onclick="location.href='../Terminos-y-Condiciones'">Términos</button>
      <button class="nav-btn" onclick="location.href='../Politicas-de-Privacidad'">Privacidad</button>
    </nav>
    <button class="hamburger" id="hamburgerBtn">☰</button>
  </header>

  <div class="mobile-menu" id="mobileMenu">
    <button class="close-btn" id="closeMenuBtn">✕</button>
    <div class="mobile-nav">
      <a href="https://cdhub.store/">Inicio</a>
      <a href="../Terminos-y-Condiciones/">Términos</a>
      <a href="../Politicas-de-Privacidad/">Privacidad</a>
    </div>
  </div>

  <main>
    <section class="intro">
      <h1>Confesiones anónimas</h1>
      <p>En esta sección puedes enviar lo que llevas dentro, sin juicios. Tus confesiones serán mostradas por 24 horas con estilo único.</p>
    </section>

    <section class="confesiones-actions">
      <button class="nav-btn" onclick="mostrarFormulario()">Hacer Confesión</button>
      <button class="nav-btn" onclick="verConfesiones()">Ver Confesiones</button>
    </section>

    <section class="formulario oculto" id="formulario">
      <form id="confesionForm">
        <input type="email" id="correo" placeholder="Tu correo (privado)" required />
        <textarea id="mensaje" maxlength="250" placeholder="Escribe tu confesión..." required></textarea>
        <select id="fondo">
          <option value="gradient1">Rosa - Morado</option>
          <option value="gradient2">Azul - Cian</option>
          <option value="gradient3">Naranja - Amarillo</option>
        </select>
        <button type="submit" class="nav-btn">Enviar</button>
      </form>
    </section>

    <section class="confesiones-lista oculto" id="confesiones">
      <div id="listaConfesiones"></div>
      <div class="navegacion">
        <button class="nav-btn" onclick="anterior()">←</button>
        <button class="nav-btn" onclick="siguiente()">→</button>
        <button class="nav-btn" onclick="verTodas()">Ver Todas</button>
      </div>
    </section>
  </main>

  <footer>
    <p>© 2025 Chilean Development</p>
    <div class="footer-buttons">
      <button onclick="location.href='../Terminos-y-Condiciones'">Términos de Uso</button>
      <button onclick="location.href='../Politicas-de-Privacidad'">Política de Privacidad</button>
    </div>
  </footer>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC_et5RjNaI38faN-U0p5inlBpHsLpGsDY",
    authDomain: "confessapp-48b52.firebaseapp.com",
    databaseURL: "https://confessapp-48b52-default-rtdb.firebaseio.com",
    projectId: "confessapp-48b52",
    storageBucket: "confessapp-48b52.firebasestorage.app",
    messagingSenderId: "961087797548",
    appId: "1:961087797548:web:ad27378e9bb44d8b025489",
    measurementId: "G-VYH6M0K0P7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const analytics = getAnalytics(app);

  let confesiones = [];
  let pagina = 0;

  async function cargarConfesiones() {
    const q = query(collection(db, "confesiones"), orderBy("fecha", "desc"));
    const snapshot = await getDocs(q);
    confesiones = snapshot.docs.map(doc => doc.data());
    mostrarConfesiones();
  }

  document.getElementById("confesionForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const correo = document.getElementById("correo").value;
    const texto = document.getElementById("mensaje").value;
    const fondo = document.getElementById("fondo").value;

    try {
      await addDoc(collection(db, "confesiones"), {
        correo,
        texto,
        fondo,
        fecha: new Date()
      });

      document.getElementById("confesionForm").reset();
      alert("Confesión enviada.");
      mostrarFormulario();
      cargarConfesiones();
    } catch (error) {
      alert("Error al enviar confesión: " + error.message);
    }
  });

  function mostrarFormulario() {
    document.getElementById('formulario').classList.remove('oculto');
    document.getElementById('confesiones').classList.add('oculto');
  }

  function verConfesiones() {
    document.getElementById('formulario').classList.add('oculto');
    document.getElementById('confesiones').classList.remove('oculto');
    mostrarConfesiones();
  }

  function mostrarConfesiones() {
    const lista = document.getElementById('listaConfesiones');
    lista.innerHTML = "";

    if (confesiones.length === 0) {
      lista.innerHTML = "<p>No hay confesiones aún.</p>";
      return;
    }

    const conf = confesiones[pagina];
    const div = document.createElement("div");
    div.className = `confesion-box ${conf.fondo}`;
    div.innerText = conf.texto;
    lista.appendChild(div);
  }

  function siguiente() {
    if (pagina < confesiones.length - 1) {
      pagina++;
      mostrarConfesiones();
    }
  }

  function anterior() {
    if (pagina > 0) {
      pagina--;
      mostrarConfesiones();
    }
  }

  function verTodas() {
    const lista = document.getElementById('listaConfesiones');
    lista.innerHTML = "";
    confesiones.forEach(conf => {
      const div = document.createElement("div");
      div.className = `confesion-box ${conf.fondo}`;
      div.innerText = conf.texto;
      lista.appendChild(div);
    });
  }

  // Exponer funciones globales para botones HTML
  window.mostrarFormulario = mostrarFormulario;
  window.verConfesiones = verConfesiones;
  window.siguiente = siguiente;
  window.anterior = anterior;
  window.verTodas = verTodas;

  // Cargar confesiones al inicio
  cargarConfesiones();
</script>

  <script src="../JS/menu.js"></script>

</body>
</html>
